<script data-pagespeed-no-defer>
    (function () {
        'use strict';

        window.cmpEnabled = false;
        if (isInCmpExperiment()) {
            window.cmpEnabled = true;
            // window.__as24_cmp_variation = 'original';
            loadCMPStub();
        }

        function isInCmpExperiment() {
            try {
                var tld = window.location.hostname.split('.').pop();
                
                if (window.location.href.indexOf('__cmp') >= 0) {
                    return true;
                }

                if (/disable-cmp=true/.test(document.cookie)) {
                    return false;
                }

                if (tld === 'de' || tld === 'nl' || tld === 'it') {
                    return true;
                    // var cmpExperimentBucket =
                    //     parseInt(localStorage.getItem('as24_cmp_experiment'), 10) || (Math.random() * 100) | 0;

                    // localStorage.setItem('as24_cmp_experiment', cmpExperimentBucket);

                    // return cmpExperimentBucket < 3;
                }

                return false;
            } catch (ex) {
                return false;
            }

            return false;
        }

        function loadCMPStub() {
            if (!window.__cmp || typeof window.__cmp !== 'function') {
                var faktorCmpStart = window.__cmp ? window.__cmp.start : {};

                window.__cmp = (function () {
                    var listen = window.attachEvent || window.addEventListener;
                    listen('message', function (event) {
                        window.__cmp.receiveMessage(event);
                    });

                    function addLocatorFrame() {
                        if (!window.frames['__cmpLocator']) {
                            if (document.body) {
                                var frame = document.createElement('iframe');
                                frame.style.display = 'none';
                                frame.name = '__cmpLocator';
                                document.body.appendChild(frame);
                            } else {
                                setTimeout(addLocatorFrame, 5);
                            }
                        }
                    }

                    addLocatorFrame();

                    var commandQueue = [];
                    var cmp = function (command, parameter, callback) {
                        if (command === 'ping') {
                            if (callback) {
                                callback({
                                    gdprAppliesGlobally: !!(
                                        window.__cmp &&
                                        window.__cmp.config &&
                                        window.__cmp.config.storeConsentGlobally
                                    ),
                                    cmpLoaded: false,
                                });
                            }
                        } else {
                            commandQueue.push({
                                command: command,
                                parameter: parameter,
                                callback: callback,
                            });
                        }
                    };
                    cmp.commandQueue = commandQueue;
                    cmp.receiveMessage = function (event) {
                        var data = event && event.data && event.data.__cmpCall;
                        if (data) {
                            commandQueue.push({
                                callId: data.callId,
                                command: data.command,
                                parameter: data.parameter,
                                event: event,
                            });
                        }
                    };

                    return cmp;
                })();

                window.__cmp.start = faktorCmpStart;
            }
        }
    })();
</script>
<script src="@@ASSET_PATH/index.min.js" defer data-pagespeed-no-defer></script>
